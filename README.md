# CVE Vulnerability Information Downloader

Common Vulnerability Scoring System (CVSS) is a free and open industry standard for assessing the severity of computer system security vulnerabilities.  
Exploit Prediction Scoring System (EPSS) estimates the likelihood that a software vulnerability will be exploited in the wild.  

This projects downloads both scoring systems and combines them into one list.  
Scanners show you the CVE number and the CVSS score, but do often not export the full details like "exploitabilityScore" or "userInteractionRequired". By adding the EPSS score you get more options to select what to do first and filter on the thresholds which makes sense for your environment. 
You can use the information to enrich the information provided from your vulnerability scanner like OpenVAS to prioritize remediation.  

After the download the required information will be extracted, formatted, and output files will be generated.  
CVSS, EPSS and a combined file of all CVE information will be available. Outputs are available in json and csv formats.  
Additionally the information is imported into a sqlite database.  

The goal was not performance or efficiency.  
The script is written in a simple way. Multiple steps are made to make easier to understand and traceable. Files from intermediate steps are written to disk to allow you make it easier for you to adjust the commands to your needs.  

## Configuration

1. You need an API key: https://nvd.nist.gov/developers/request-an-api-key  
2. cp env_example .env  
3. edit the .env file and add your API key  
4. optional: edit docker-compose file and adjust the cron schedule
4. optional: edit data/vulnerability-tables-logstash/config/logstash.conf  
5. docker-compose up -d  
6. you will find the files in data/vulnerability-tables-cron/output/ after the script completed. It needs several minutes.  

## Run

You can either wait for cron to execute the download script on a schedule. 
Alternatively you can execute the download script manually by running:
```
docker exec -it vulnerability-tables-cron bash /opt/scripts/download.sh
```

## Container Description

There are three docker containers.  
The cron container downloads the information once a week (Monday 06:00) and stores the files in the output directory.  
It uses curl and wget to download files. jq is used work with json.  

The filebeat container reads the json files and forwards it to the logstash container.  
The logstash container can be used to send to a opensearch instance, upload it to Azure Log Analytics, or other supported outputs.  
Filebeat and logstash are optional and are only included for continence.  

## Example output files

Several output files will be generated. Here is an estimate:
```
 50M   CVSS.csv
178M   CVSS.json
  6M   EPSS.csv
 12M   EPSS.json
 54M   CVE.csv
193M   CVE.json
 48M   database.sqlite
```

You can expect this information for every CVE:  
```
grep -i 'CVE-2021-44228' CVE.json | jq
{
  "CVE": "CVE-2021-44228",
  "CVSS2_accessComplexity": "AV:N/AC:M/Au:N/C:C/I:C/A:C",
  "CVSS2_accessVector": "NETWORK",
  "CVSS2_authentication": "MEDIUM",
  "CVSS2_availabilityImpact": "NONE",
  "CVSS2_baseScore": "COMPLETE",
  "CVSS2_baseSeverity": "COMPLETE",
  "CVSS2_confidentialityImpact": "COMPLETE",
  "CVSS2_exploitabilityScore": "9.3",
  "CVSS2_impactScore": "HIGH",
  "CVSS2_integrityImpact": "8.6",
  "CVSS2_vectorString": "10",
  "CVSS3_attackComplexity": "null",
  "CVSS3_attackVector": "null",
  "CVSS3_availabilityImpact": "null",
  "CVSS3_baseScore": "null",
  "CVSS3_baseSeverity": "null",
  "CVSS3_confidentialityImpact": "null",
  "CVSS3_exploitabilityScore": "null",
  "CVSS3_impactScore": "null",
  "CVSS3_integrityImpact": "null",
  "CVSS3_privilegesRequired": "null",
  "CVSS3_scope": "null",
  "CVSS3_userInteraction": "null",
  "CVSS3_vectorString": "null",
  "CVSS3_acInsufInfo": "null",
  "CVSS3_obtainAllPrivilege": "null",
  "CVSS3_obtainUserPrivilege": "null",
  "CVSS3_obtainOtherPrivilege": "null",
  "CVSS3_userInteractionRequired": "null",
  "EPSS": "0.97095",
  "Percentile": "0.99998"
}
```

## Links
- https://www.first.org/epss/user-guide  
- https://nvd.nist.gov/developers/vulnerabilities  
